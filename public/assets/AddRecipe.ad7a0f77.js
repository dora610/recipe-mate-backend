import{r as n,e as te,j as r,c as i,F as j,d as I,a as q,t as z}from"./vendor.5b1461ab.js";import{u as re,r as se,A as E,h as L}from"./index.ee0cf3e0.js";function oe(){const{user:b,isUserAuthenticated:ae}=re(),[l,ie]=n.exports.useContext(se),[v,u]=n.exports.useState(!1),[y,o]=n.exports.useState(""),[m,N]=n.exports.useState(!1),w=te(),[P,S]=n.exports.useState(""),[U,R]=n.exports.useState(""),[$,C]=n.exports.useState(""),[_,F]=n.exports.useState(""),[H,T]=n.exports.useState(""),[O,k]=n.exports.useState(""),[d,h]=n.exports.useState([]),[p,g]=n.exports.useState([]),f=n.exports.useRef(""),x=n.exports.useRef(""),A=n.exports.useRef("");n.exports.useEffect(()=>{var e;((e=w.state)==null?void 0:e.from)==="showRecipe"?(S(l.recipe.name),R(l.recipe.description),C(l.recipe.type),F(l.recipe.course),T(l.recipe.preparationTime),k(l.recipe.cookTime),h(l.recipe.ingredients),g(l.recipe.steps),A.current=l.recipe.photo.square,N(!0)):N(!1)},[w.state]);const B=n.exports.useRef(["veg","non-veg"]),J=n.exports.useRef(["main-course","starter","dessert","snacks","beverages"]),V=e=>{e.preventDefault(),o("");const t=document.querySelector("form"),s=new FormData(t);s.set("ingredients",JSON.stringify(d)),s.set("steps",JSON.stringify(p));let a=G(s);if(a){o(a);return}m?M(s):K(s)},G=e=>{if(console.groupCollapsed("form data"),d.length<1)return"Ingredient must be added";if(p.length<1)return"Steps are missing";for(const[t,s]of e.entries())if(console.log(t,s),t!=="photo"&&(Array.isArray(s)&&s.length()<1||!s))return`${t} is missing`;if(!e.get("name"))return"Name is not present";if(!e.get("type"))return"Valid type must be selected";if(!e.get("course"))return"Valid course must be selected";if(e.get("preparationTime")<1)return"Enter valid preparation time";if(e.get("cookTime")<1)return"Enter valid cooking time";if(!e.get("ingredients"))return"Ingredients not added";if(!e.get("steps"))return"Steps are required";console.groupEnd("form data")},K=e=>{const{userId:t,jwt:s}=b;o(""),u(!0),q.post(`${E}/recipe`,e,{headers:{Authorization:`Bearer ${s}`,auth:t}}).then(a=>{if(a.data.error)throw new Error(a.data.error);z.success(a.data.status)}).catch(a=>o(L(a))).finally(()=>u(!1))},M=e=>{const{userId:t,jwt:s}=b;o(""),u(!0),q.put(`${E}/recipe/${l.recipe._id}`,e,{headers:{Authorization:`Bearer ${s}`,auth:t}}).then(a=>{if(a.data.error)throw new Error(a.data.error);z.success(a.data.status)}).catch(a=>o(L(a))).finally(()=>u(!1))},Q=e=>{o("");const t=e.target.files[0];if(!t.type.includes("image")){o("Incorrect file type, only jpg/png/jpeg files are allowed");return}if(t.size>5*1024*1024){o("File size exceeded, max limit 5mb");return}const s=new FileReader;s.readAsDataURL(t),s.addEventListener("load",c=>{a.setAttribute("src",c.target.result)});const a=document.querySelector(".preview-section .thumbnail img");W(t.name,t.size)},W=(e,t)=>{document.querySelector(".preview-section .file-name > span").textContent=e,document.querySelector(".preview-section .file-size > span").textContent=X(t)},X=e=>{let t=["kb","mb","gb","tb"],s="",a=e,c=0;for(;a>1024&&c<4;)a=parseFloat(a/1024).toFixed(2),s=`${a} ${t[c]}`,c++;return s},Y=e=>{e.stopPropagation();const t=f.current.value;t&&!t.includes(",")&&(h([...d,t]),f.current.value="")},Z=e=>{e.stopPropagation();const t=x.current.value;t&&!t.includes(",")&&(g([...p,t]),x.current.value="")},D=(e,t)=>{e.stopPropagation();const s=p.filter((a,c)=>c!==t);g([...s])},ee=(e,t)=>{e.stopPropagation();const s=d.filter((a,c)=>c!==t);h([...s])};return r("div",{className:"bg-fuchsia-50/50 py-4",children:i("div",{className:"form-card-wide",children:[r("h2",{className:"form-card-title",children:m?"Update Recipe":"Add Recipe"}),y&&r("div",{className:"text-danger",children:r("p",{children:y})}),v&&r("div",{className:"text-warn",children:r("p",{children:"Loading..."})}),i("form",{onSubmit:V,className:"my-6 py-4 text-base font-normal w-full text-slate-700 border-t-2 border-fuchsia-200 capitalize flex flex-col items-center justify-between gap-6",encType:"multipart/form-data",children:[i("div",{className:"grid lg:grid-rows-[7] lg:grid-cols-3 sm:grid-cols-2 gap-x-6 gap-y-2 lg:grid-flow-col items-start",children:[i("div",{className:"photo-section px-2 lg:col-start-1 lg:row-start-1 lg:row-end-7 lg:row-span-[7] row-span-6",children:[i("div",{className:"preview-section",children:[r("div",{className:"thumbnail mb-7 shadow-lg h-80 rounded-md",children:r("img",{src:m?A.current:"",alt:"Upload recipe photo",className:"flex justify-center items-center bg-gray-100 text-slate-400 object-cover w-full h-full rounded-md"})}),i("p",{className:"file-name",children:["filename: ",r("span",{className:"text-slate-500"})]}),i("p",{className:"file-size",children:["filesize: ",r("span",{className:"text-slate-500"})]})]}),r("input",{type:"file",name:"photo",id:"photo",onChange:Q,className:"file-upload-input"})]}),i("div",{className:"flex flex-col justify-start",children:[r("label",{htmlFor:"name",className:"",children:"Recipe Name"}),r("input",{type:"text",name:"name",id:"name",className:"input-normal",required:!0,value:P,onChange:e=>S(e.target.value)})]}),i("div",{className:"flex flex-col justify-start h-36",children:[r("label",{htmlFor:"description",children:"Description"}),r("textarea",{name:"description",id:"description",cols:"20",rows:"3",className:"col-span-3 px-4 py-2 mt-3 rounded-lg border-stone-200 bg-fuchsia-50 hover:bg-stone-100/50 hover:border-fuchsia-200",value:U,onChange:e=>R(e.target.value)})]}),i("div",{className:"grid grid-cols-2 items-center",children:[r("label",{htmlFor:"type",children:"Type"}),i("select",{name:"type",id:"type",className:"input-normal",required:!0,value:$,onChange:e=>C(e.target.value),children:[r("option",{value:"",disabled:!0,children:"choose type"}),B.current.map((e,t)=>r("option",{value:e,children:e},t))]})]}),i("div",{className:"grid grid-cols-2 items-center",children:[r("label",{htmlFor:"course",children:"Course"}),i("select",{name:"course",id:"course",className:"input-normal",required:!0,value:_,onChange:e=>F(e.target.value),children:[r("option",{value:"",disabled:!0,children:"choose course"}),J.current.map((e,t)=>r("option",{value:e,children:e},t))]})]}),i("div",{className:"grid grid-cols-2 items-center",children:[r("label",{htmlFor:"preparationTime",children:"Preparation Time in min"}),r("input",{type:"number",name:"preparationTime",id:"preparationTime",className:"input-normal",required:!0,value:H,onChange:e=>T(e.target.value)})]}),i("div",{className:"grid grid-cols-2 items-center",children:[r("label",{htmlFor:"cookTime",children:"Cook Time in min"}),r("input",{type:"number",name:"cookTime",id:"cookTime",className:"input-normal",required:!0,value:O,onChange:e=>k(e.target.value)})]}),i("div",{className:"lg:row-span-2 row-span-3  items-baseline",children:[r("label",{htmlFor:"ingredients",children:"Ingredients"}),i("div",{className:"grid lg:grid-cols-4 grid-cols-[minmax(8rem,_1fr)_3rem] gap-2 items-center",children:[r("input",{type:"text",name:"ingredients",id:"ingredients",ref:f,className:"input-normal lg:col-span-3"}),r("button",{className:"bg-fuchsia-100 rounded-xl  h-10 text-center group  hover:text-white hover:bg-fuchsia-500",onClick:Y,type:"button",children:r(j,{className:"fill-fuchsia-400 h-4 mx-auto group-hover:fill-white"})})]}),d.length>0&&r("ul",{className:"w-full row-span-3 flex flex-wrap gap-2 bg-gray-200/50 px-4 py-4 rounded-md max-h-32 overflow-y-auto my-2",children:d.map((e,t)=>i("li",{className:"min-card-blocks flex justify-between items-baseline gap-2 hover:cursor-pointer",children:[r("h5",{children:e}),r("button",{type:"button",onClick:s=>ee(s,t),children:r(I,{className:"fill-red-400 h-3"})})]},t))})]}),i("div",{className:"lg:row-span-3 row-span-4 lg:h-64 min-h-44 max-h-80",children:[r("label",{htmlFor:"steps",children:"Steps"}),i("div",{className:"grid lg:grid-cols-4 grid-cols-[minmax(8rem,_1fr)_3rem] gap-2 items-start",children:[r("textarea",{name:"steps",id:"steps",rows:"3",ref:x,className:"input-normal lg:col-span-3"}),r("button",{type:"button",className:"bg-fuchsia-100 rounded-xl mt-2 h-10 text-center group  hover:text-white hover:bg-fuchsia-500",onClick:Z,children:r(j,{className:"fill-fuchsia-400 h-4 mx-auto group-hover:fill-white"})})]}),r("div",{className:"max-h-48 bg-gray-200/50 rounded-lg overflow-y-auto",children:p.map((e,t)=>i("details",{className:"text-slate-900 open:bg-white open:shadow-xl open:rounded-lg open:my-2 px-4 py-2 mx-2",children:[i("summary",{className:"text-sm leading-7 font-semibold select-none marker:text-fuchsia-600",children:[i("span",{children:["Step ",t+1]}),r("button",{type:"button",className:"ml-4",onClick:s=>D(s,t),children:r(I,{className:"fill-red-400 h-3"})})]}),r("p",{className:"text-slate-700 leading-6 text-sm py-2 ",children:e})]},t))})]})]}),function(){return r("button",{type:"submit",disabled:v,className:"btn-primary w-1/3",children:m?"Update Recipe":"Add Recipe"})}()]})]})})}export{oe as default};
